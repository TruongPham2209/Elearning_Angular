<div class="container-fluid py-4">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h5 class="card-title mb-0">Quản lý khóa học</h5>
                        </div>
                        <div class="col-md-4 text-end">
                            <button
                                type="button"
                                class="btn btn-primary btn-sm"
                                (click)="openAddModal()"
                                [disabled]="isLoading"
                            >
                                <i class="bi bi-plus-circle me-2"></i>
                                Thêm khóa học
                            </button>
                        </div>
                    </div>
                </div>

                <div class="card-body">
                    <!-- Table -->
                    <div class="table-responsive" [class.loading]="isLoading">
                        <table class="table table-striped table-hover">
                            <thead class="table-dark">
                                <tr>
                                    <th scope="col">#</th>
                                    <th scope="col">Tên khóa học</th>
                                    <th scope="col">Số buổi</th>
                                    <th scope="col">Mô tả ngắn</th>
                                    <th scope="col" class="text-center">Thao tác</th>
                                </tr>
                            </thead>

                            <tbody>
                                <!-- Loading Overlay -->
                                <tr class="loading-overlay" *ngIf="isLoading">
                                    <td colspan="6" class="text-center">
                                        <div class="d-flex flex-column justify-content-center align-items-center py-4">
                                            <div class="spinner-border text-primary" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                            <div class="mt-2">Đang tải dữ liệu...</div>
                                        </div>
                                    </td>
                                </tr>
                                <tr *ngFor="let course of courses.contents; let i = index">
                                    <td>{{ courses.currentPage * courses.pageSize + i + 1 }}</td>
                                    <td>{{ course.name }}</td>
                                    <td>{{ course.sessions }}</td>
                                    <td>{{ course.shortDescription }}</td>
                                    <td class="text-center">
                                        <div class="btn-group" role="group">
                                            <button
                                                type="button"
                                                class="btn btn-outline-info btn-sm"
                                                (click)="viewClasses(course.id)"
                                                title="Xem các lớp học"
                                            >
                                                <i class="bi bi-eye"></i>
                                            </button>
                                            <button
                                                type="button"
                                                class="btn btn-outline-primary btn-sm"
                                                (click)="openEditModal(course)"
                                                title="Chỉnh sửa"
                                            >
                                                <i class="bi bi-pencil-square"></i>
                                            </button>
                                            <button
                                                type="button"
                                                class="btn btn-outline-danger btn-sm"
                                                (click)="openDeleteModal(course)"
                                                title="Xóa"
                                            >
                                                <i class="bi bi-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                <tr *ngIf="courses.contents.length === 0 && !isLoading">
                                    <td colspan="6" class="text-center text-muted">
                                        Chưa có khóa học nào trong học kỳ này
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Pagination -->
                    <nav *ngIf="courses.totalPages > 1" class="mt-4">
                        <div class="row align-items-center">
                            <div class="col-md-6">
                                <ul class="pagination pagination-sm justify-content-end mb-0">
                                    <!-- Previous Button -->
                                    <li class="page-item" [class.disabled]="courses.currentPage === 0">
                                        <button
                                            class="page-link"
                                            (click)="onPageChange(courses.currentPage - 1)"
                                            [disabled]="courses.currentPage === 0 || isLoading"
                                        >
                                            <i class="bi bi-chevron-left"></i>
                                        </button>
                                    </li>

                                    <!-- Page Numbers -->
                                    <li
                                        *ngFor="let page of getDisplayPages()"
                                        class="page-item"
                                        [class.active]="page === courses.currentPage"
                                        [class.disabled]="page === -1"
                                    >
                                        <button
                                            *ngIf="page !== -1"
                                            class="page-link"
                                            (click)="onPageChange(page)"
                                            [disabled]="isLoading"
                                        >
                                            {{ page + 1 }}
                                        </button>
                                        <span *ngIf="page === -1" class="page-link">...</span>
                                    </li>

                                    <!-- Next Button -->
                                    <li
                                        class="page-item"
                                        [class.disabled]="courses.currentPage >= courses.totalPages - 1"
                                    >
                                        <button
                                            class="page-link"
                                            (click)="onPageChange(courses.currentPage + 1)"
                                            [disabled]="courses.currentPage >= courses.totalPages - 1 || isLoading"
                                        >
                                            <i class="bi bi-chevron-right"></i>
                                        </button>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </nav>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add/Edit Modal with Enhanced Styling -->
<div
    class="modal fade show d-block"
    [class.d-none]="!showModal"
    tabindex="-1"
    style="background-color: rgba(0, 0, 0, 0.5)"
    (click)="closeModal()"
>
    <div class="modal-dialog modal-dialog-centered modal-lg" (click)="$event.stopPropagation()">
        <div class="modal-content border-0 shadow-lg">
            <!-- Enhanced Modal Header -->
            <div class="modal-header bg-primary text-white px-4 py-2">
                <h5 class="modal-title fs-5 fw-semibold">
                    <i class="bi bi-book me-2"></i>
                    {{ isEditMode ? 'Chỉnh sửa khóa học' : 'Thêm khóa học mới' }}
                </h5>
                <button
                    type="button"
                    class="btn-close btn-close-white"
                    (click)="closeModal()"
                    aria-label="Close"
                ></button>
            </div>

            <div class="modal-body p-4">
                <form #courseForm="ngForm">
                    <!-- Tên khóa học -->
                    <div class="mb-4">
                        <label for="courseName" class="form-label fw-medium">
                            <i class="bi bi-card-heading me-1 text-primary"></i>
                            Tên khóa học <span class="text-danger">*</span>
                        </label>
                        <div class="input-group">
                            <span class="input-group-text bg-light border-primary">
                                <i class="bi bi-pencil text-primary"></i>
                            </span>
                            <input
                                type="text"
                                class="form-control form-control-lg border-primary border-end-1"
                                id="courseName"
                                [(ngModel)]="currentCourseForm.name"
                                name="courseName"
                                required
                                placeholder="Nhập tên khóa học"
                            />
                        </div>
                    </div>

                    <!-- Số buổi học -->
                    <div class="mb-4">
                        <label for="sessions" class="form-label fw-medium">
                            <i class="bi bi-calendar-week me-1 text-primary"></i>
                            Số buổi học <span class="text-danger">*</span>
                        </label>
                        <div class="input-group">
                            <span class="input-group-text bg-light border-primary">
                                <i class="bi bi-123 text-primary"></i>
                            </span>
                            <input
                                type="number"
                                class="form-control form-control-lg border-primary border-end-1"
                                id="sessions"
                                [(ngModel)]="currentCourseForm.sessions"
                                name="sessions"
                                required
                                min="1"
                                max="20"
                                placeholder="Nhập số buổi học (1-20)"
                            />
                        </div>
                        <div class="form-text text-muted mt-2">
                            <i class="bi bi-info-circle me-1 text-info"></i>Số buổi học từ 1 đến 20
                        </div>
                    </div>

                    <!-- Mô tả ngắn -->
                    <div class="mb-4">
                        <label for="courseDescription" class="form-label fw-medium">
                            <i class="bi bi-text-paragraph me-1 text-primary"></i>
                            Mô tả khóa học <span class="text-danger">*</span>
                        </label>
                        <div class="input-group">
                            <span class="input-group-text bg-light border-primary align-items-start">
                                <i class="bi bi-chat-left-text text-primary mt-1"></i>
                            </span>
                            <textarea
                                class="form-control form-control-lg border-primary border-end-1"
                                id="courseDescription"
                                [(ngModel)]="currentCourseForm.shortDescription"
                                name="courseDescription"
                                required
                                placeholder="Nhập mô tả khóa học"
                                rows="4"
                            ></textarea>
                        </div>
                    </div>
                </form>
            </div>

            <div class="modal-footer bg-light">
                <button type="button" class="btn btn-outline-secondary rounded-2 px-4 py-2" (click)="closeModal()">
                    Hủy
                </button>
                <button
                    type="button"
                    class="btn btn-primary rounded-2 px-4 py-2"
                    (click)="saveCourse()"
                    [disabled]="disableButton()"
                >
                    <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2"></span>
                    <i *ngIf="!isLoading" class="bi bi-save me-2 text-white"></i>
                    {{ isEditMode ? 'Cập nhật' : 'Thêm mới' }}
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div
    class="modal fade show d-block"
    [class.d-none]="!showDeleteModal"
    tabindex="-1"
    style="background-color: rgba(0, 0, 0, 0.5)"
    (click)="closeDeleteModal()"
>
    <div class="modal-dialog modal-dialog-centered" (click)="$event.stopPropagation()">
        <div class="modal-content">
            <div class="modal-header">
                <i class="bi bi-exclamation-triangle me-2 text-danger"></i>
                <h5 class="modal-title text-danger" id="deleteModalLabel">Xác nhận xóa</h5>
                <button type="button" class="btn-close" (click)="closeDeleteModal()"></button>
            </div>
            <div class="modal-body">
                <div class="text-center">
                    <i class="bi bi-exclamation-triangle text-warning display-4 mb-3"></i>
                    <p class="mb-3">Bạn có chắc chắn muốn xóa lớp</p>
                    <p class="fw-bold text-danger">{{ courseToDelete?.name }}?</p>
                    <p class="text-muted small">
                        <i class="bi bi-info-circle me-1"></i>
                        Hành động này không thể hoàn tác!
                    </p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" (click)="closeDeleteModal()">Hủy</button>
                <button type="button" class="btn btn-danger" (click)="deleteCourse()" [disabled]="isLoading">
                    <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2"></span>
                    <i class="bi bi-trash me-2"></i>
                    Xóa
                </button>
            </div>
        </div>
    </div>
</div>
