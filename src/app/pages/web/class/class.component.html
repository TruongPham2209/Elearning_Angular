<div class="container-fluid py-4">
    <div class="row">
        <div class="col-12">
            <!-- Quản lý buổi học -->
            <div class="card mb-4">
                <div class="card-header bg-light">
                    <div class="row">
                        <!-- Cột thông tin lớp học -->
                        <div class="col-md-6 border-end pe-4">
                            <h5 class="text-primary mb-3"><i class="bi bi-book me-2"></i> Thông tin lớp học</h5>
                            <ul class="list-unstyled text-dark mb-0">
                                <li class="mb-2 d-flex align-items-center">
                                    <i class="bi bi-people-fill me-2 fs-5 text-info"></i>
                                    <div>
                                        <span class="fw-bold text-dark">Lớp:</span>
                                        <span class="text-muted">{{ currentClass.name }}</span>
                                    </div>
                                </li>
                                <li class="mb-2 d-flex align-items-center">
                                    <i class="bi bi-geo-alt-fill me-2 fs-5 text-info"></i>
                                    <div>
                                        <span class="fw-bold text-dark">Phòng học:</span>
                                        <span class="text-muted">{{ currentClass.room }}</span>
                                    </div>
                                </li>
                                <li class="mb-2 d-flex align-items-center">
                                    <i class="bi bi-clock-fill me-2 fs-5 text-info"></i>
                                    <div>
                                        <span class="fw-bold text-dark">Ca học:</span>
                                        <span class="text-muted">{{ currentClass.schedule }}</span>
                                    </div>
                                </li>
                            </ul>
                        </div>

                        <!-- Cột thông tin giảng viên -->
                        <div class="col-md-6 ps-4">
                            <h5 class="text-primary mb-3">
                                <i class="bi bi-person-vcard me-2"></i> Thông tin giảng viên
                            </h5>
                            <ul class="list-unstyled text-dark mb-0">
                                <li class="mb-2 d-flex align-items-center">
                                    <i class="bi bi-person-fill me-2 fs-5 text-success"></i>
                                    <div>
                                        <span class="fw-bold text-dark">Tên giảng viên:</span>
                                        <span class="text-muted">{{ currentClass.lecturerName }}</span>
                                    </div>
                                </li>
                                <li class="mb-2 d-flex align-items-center">
                                    <i class="bi bi-envelope-fill me-2 fs-5 text-success"></i>
                                    <div>
                                        <span class="fw-bold text-dark">Email:</span>
                                        <span class="text-muted">{{ currentClass.lecturerEmail }}</span>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="accordion" id="lessionsAccordion">
                        <div *ngFor="let lession of lessions" class="accordion-item mb-3">
                            <h2 class="accordion-header">
                                <button
                                    class="accordion-button"
                                    [class.collapsed]="!isLessionExpanded(lession.id)"
                                    type="button"
                                    (click)="toggleLession(lession.id)"
                                >
                                    {{ lession.name }}
                                </button>
                            </h2>
                            <div class="accordion-collapse collapse" [class.show]="isLessionExpanded(lession.id)">
                                <div class="accordion-body">
                                    <!-- Tài liệu -->
                                    <div class="mb-4">
                                        <div *ngIf="lession.documents?.length === 0" class="text-muted">
                                            Chưa có tài liệu nào
                                        </div>

                                        <div *ngFor="let document of lession.documents" class="card mb-2">
                                            <div class="card-body">
                                                <div class="d-flex justify-content-between align-items-start">
                                                    <div class="flex-grow-1">
                                                        <h6 class="card-title">{{ document.title }}</h6>
                                                        <p class="card-text">{{ document.content }}</p>
                                                        <p class="card-text">
                                                            <strong>File đính kèm: </strong>
                                                            <a href="#" class="text-decoration-none">{{
                                                                document.fileName
                                                            }}</a>
                                                        </p>
                                                        <small class="text-muted">
                                                            Tạo ngày:
                                                            {{ document.uploadAt | date: 'dd/MM/yyyy' }}
                                                        </small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Bài tập -->
                                    <div class="mb-4">
                                        <div *ngIf="lession.assignments?.length === 0" class="text-muted">
                                            Chưa có bài tập nào
                                        </div>

                                        <div *ngFor="let assignment of lession.assignments" class="card mb-2">
                                            <div class="card-body">
                                                <div class="d-flex justify-content-between align-items-start">
                                                    <div class="flex-grow-1">
                                                        <h6 class="card-title">
                                                            <a
                                                                href="javascript:void(0)"
                                                                class="text-decoration-none"
                                                                (click)="goToSubmissions(lession.id)"
                                                            >
                                                                {{ assignment.title }}
                                                            </a>
                                                        </h6>
                                                        <small class="text-muted">
                                                            Hạn nộp: {{ assignment.deadline | date: 'dd/MM/yyyy' }}
                                                        </small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Thông báo lớp học -->
            <div class="card">
                <div class="card-header">
                    <div class="d-flex justify-content-between align-items-center">
                        <h4 class="mb-0">Thông báo lớp học</h4>
                        <button class="btn btn-outline-secondary" (click)="toggleAnnouncementDropdown()">
                            <i
                                class="bi"
                                [class.bi-chevron-down]="!showAnnouncementDropdown"
                                [class.bi-chevron-up]="showAnnouncementDropdown"
                            ></i>
                        </button>
                    </div>
                </div>
                <div class="card-body" [class.d-none]="!showAnnouncementDropdown">
                    <div *ngIf="announcements.contents.length === 0" class="text-muted">Chưa có thông báo nào</div>

                    <div *ngFor="let announcement of announcements.contents" class="card mb-2">
                        <div class="card-body">
                            <h6 class="card-title">{{ announcement.title }}</h6>
                            <p class="card-text">
                                <a
                                    href="javascript:void(0)"
                                    class="text-decoration-none"
                                    (click)="viewAnnouncementDetail(announcement)"
                                >
                                    {{
                                        announcement.content.length > 100
                                            ? (announcement.content | slice: 0 : 100) + '...'
                                            : announcement.content
                                    }}
                                </a>
                            </p>
                            <small class="text-muted">
                                {{ announcement.createdAt | date: 'dd/MM/yyyy' }}
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal chi tiết thông báo -->
<div
    class="modal fade"
    [class.show]="showAnnouncementDetailModal"
    [style.display]="showAnnouncementDetailModal ? 'block' : 'none'"
    tabindex="-1"
>
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">{{ selectedAnnouncement?.title }}</h5>
                <button type="button" class="btn-close" (click)="closeAnnouncementDetailModal()"></button>
            </div>
            <div class="modal-body">
                <p>{{ selectedAnnouncement?.content }}</p>
                <hr />
                <small class="text-muted">
                    Ngày tạo: {{ selectedAnnouncement ? (selectedAnnouncement.createdAt | date: 'dd/MM/yyyy') : '' }}
                </small>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" (click)="closeAnnouncementDetailModal()">Đóng</button>
            </div>
        </div>
    </div>
</div>
