<div class="container-fluid py-4">
    <div class="row">
        <div class="col-12">
            <h2 class="mb-4">Quản lý lớp học</h2>

            <!-- Quản lý buổi học -->
            <div class="card mb-4">
                <div class="card-header">
                    <h4 class="mb-0">Quản lý buổi học</h4>
                </div>
                <div class="card-body">
                    <div class="accordion" id="lessionsAccordion">
                        <div *ngFor="let lession of lessions" class="accordion-item mb-3">
                            <h2 class="accordion-header">
                                <button
                                    class="accordion-button"
                                    [class.collapsed]="!isLessionExpanded(lession.id)"
                                    type="button"
                                    (click)="toggleLession(lession.id)"
                                >
                                    {{ lession.name }}
                                </button>
                            </h2>
                            <div class="accordion-collapse collapse" [class.show]="isLessionExpanded(lession.id)">
                                <div class="accordion-body">
                                    <!-- Tài liệu -->
                                    <div class="mb-4">
                                        <div class="d-flex justify-content-between align-items-center mb-3">
                                            <h5>Tài liệu</h5>
                                            <button
                                                class="btn btn-primary btn-sm"
                                                (click)="openDocumentModal(lession.id)"
                                            >
                                                <i class="bi bi-plus"></i> Thêm tài liệu
                                            </button>
                                        </div>

                                        <div *ngIf="lession.documents.length === 0" class="text-muted">
                                            Chưa có tài liệu nào
                                        </div>

                                        <div *ngFor="let document of lession.documents" class="card mb-2">
                                            <div class="card-body">
                                                <div class="d-flex justify-content-between align-items-start">
                                                    <div class="flex-grow-1">
                                                        <h6 class="card-title">{{ document.title }}</h6>
                                                        <p class="card-text">{{ document.content }}</p>
                                                        <p class="card-text">
                                                            <strong>File đính kèm: </strong>
                                                            <a href="#" class="text-decoration-none">{{
                                                                document.fileName
                                                            }}</a>
                                                        </p>
                                                        <small class="text-muted">
                                                            Tạo ngày: {{ formatDate(document.createdAt) }}
                                                        </small>
                                                    </div>
                                                    <button
                                                        class="btn btn-outline-danger btn-sm"
                                                        (click)="confirmDeleteDocument(document)"
                                                    >
                                                        <i class="bi bi-trash"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Bài tập -->
                                    <div class="mb-4">
                                        <div class="d-flex justify-content-between align-items-center mb-3">
                                            <h5>Bài tập</h5>
                                            <button
                                                class="btn btn-success btn-sm"
                                                (click)="openAssignmentModal(lession.id)"
                                            >
                                                <i class="bi bi-plus"></i> Thêm bài tập
                                            </button>
                                        </div>

                                        <div *ngIf="lession.assignments.length === 0" class="text-muted">
                                            Chưa có bài tập nào
                                        </div>

                                        <div *ngFor="let assignment of lession.assignments" class="card mb-2">
                                            <div class="card-body">
                                                <div class="d-flex justify-content-between align-items-start">
                                                    <div class="flex-grow-1">
                                                        <h6 class="card-title">
                                                            <a
                                                                href="javascript:void(0)"
                                                                class="text-decoration-none"
                                                                (click)="goToSubmissions(lession.id)"
                                                            >
                                                                {{ assignment.title }}
                                                            </a>
                                                        </h6>
                                                        <small class="text-muted">
                                                            Hạn nộp: {{ formatDate(assignment.deadline) }}
                                                        </small>
                                                    </div>
                                                    <button
                                                        class="btn btn-outline-danger btn-sm"
                                                        (click)="confirmDeleteAssignment(assignment)"
                                                    >
                                                        <i class="bi bi-trash"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Thông báo lớp học -->
            <div class="card">
                <div class="card-header">
                    <div class="d-flex justify-content-between align-items-center">
                        <h4 class="mb-0">Thông báo lớp học</h4>
                        <button class="btn btn-outline-secondary" (click)="toggleAnnouncementDropdown()">
                            <i
                                class="bi"
                                [class.bi-chevron-down]="!showAnnouncementDropdown"
                                [class.bi-chevron-up]="showAnnouncementDropdown"
                            ></i>
                        </button>
                    </div>
                </div>
                <div class="card-body" [class.d-none]="!showAnnouncementDropdown">
                    <div class="mb-3">
                        <button class="btn btn-primary" (click)="openAnnouncementModal()">
                            <i class="bi bi-plus"></i> Tạo thông báo mới
                        </button>
                    </div>

                    <div *ngIf="announcements.length === 0" class="text-muted">Chưa có thông báo nào</div>

                    <div *ngFor="let announcement of announcements" class="card mb-2">
                        <div class="card-body">
                            <h6 class="card-title">{{ announcement.title }}</h6>
                            <p class="card-text">
                                <a
                                    href="javascript:void(0)"
                                    class="text-decoration-none"
                                    (click)="viewAnnouncementDetail(announcement)"
                                >
                                    {{
                                        announcement.content.length > 100
                                            ? (announcement.content | slice: 0 : 100) + '...'
                                            : announcement.content
                                    }}
                                </a>
                            </p>
                            <small class="text-muted">
                                {{ formatDate(announcement.createdAt) }}
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal tạo thông báo -->
<div
    class="modal fade"
    [class.show]="showAnnouncementModal"
    [style.display]="showAnnouncementModal ? 'block' : 'none'"
    tabindex="-1"
>
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Tạo thông báo mới</h5>
                <button type="button" class="btn-close" (click)="closeAnnouncementModal()"></button>
            </div>
            <div class="modal-body">
                <form (ngSubmit)="createAnnouncement()">
                    <div class="mb-3">
                        <label for="announcementTitle" class="form-label">Tiêu đề</label>
                        <input
                            type="text"
                            class="form-control"
                            id="announcementTitle"
                            [(ngModel)]="newAnnouncement.title"
                            name="title"
                            required
                        />
                    </div>
                    <div class="mb-3">
                        <label for="announcementContent" class="form-label">Nội dung</label>
                        <textarea
                            class="form-control"
                            id="announcementContent"
                            rows="4"
                            [(ngModel)]="newAnnouncement.content"
                            name="content"
                            required
                        ></textarea>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" (click)="closeAnnouncementModal()">Hủy</button>
                        <button type="submit" class="btn btn-primary">Tạo thông báo</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Modal chi tiết thông báo -->
<div
    class="modal fade"
    [class.show]="showAnnouncementDetailModal"
    [style.display]="showAnnouncementDetailModal ? 'block' : 'none'"
    tabindex="-1"
>
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">{{ selectedAnnouncement?.title }}</h5>
                <button type="button" class="btn-close" (click)="closeAnnouncementDetailModal()"></button>
            </div>
            <div class="modal-body">
                <p>{{ selectedAnnouncement?.content }}</p>
                <hr />
                <small class="text-muted">
                    Ngày tạo: {{ selectedAnnouncement ? formatDate(selectedAnnouncement.createdAt) : '' }}
                </small>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" (click)="closeAnnouncementDetailModal()">Đóng</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal tạo tài liệu -->
<div
    class="modal fade"
    [class.show]="showDocumentModal"
    [style.display]="showDocumentModal ? 'block' : 'none'"
    tabindex="-1"
>
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Thêm tài liệu</h5>
                <button type="button" class="btn-close" (click)="closeDocumentModal()"></button>
            </div>
            <div class="modal-body">
                <form (ngSubmit)="createDocument()">
                    <div class="mb-3">
                        <label for="documentTitle" class="form-label">Tiêu đề</label>
                        <input
                            type="text"
                            class="form-control"
                            id="documentTitle"
                            [(ngModel)]="newDocument.title"
                            name="title"
                            required
                        />
                    </div>
                    <div class="mb-3">
                        <label for="documentContent" class="form-label">Nội dung</label>
                        <textarea
                            class="form-control"
                            id="documentContent"
                            rows="3"
                            [(ngModel)]="newDocument.content"
                            name="content"
                            required
                        ></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="documentFile" class="form-label">File đính kèm</label>
                        <input
                            type="file"
                            class="form-control"
                            id="documentFile"
                            (change)="onFileSelect($event)"
                            required
                        />
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" (click)="closeDocumentModal()">Hủy</button>
                        <button type="submit" class="btn btn-primary">Thêm tài liệu</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Modal tạo bài tập -->
<div
    class="modal fade"
    [class.show]="showAssignmentModal"
    [style.display]="showAssignmentModal ? 'block' : 'none'"
    tabindex="-1"
>
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Thêm bài tập</h5>
                <button type="button" class="btn-close" (click)="closeAssignmentModal()"></button>
            </div>
            <div class="modal-body">
                <form (ngSubmit)="createAssignment()">
                    <div class="mb-3">
                        <label for="assignmentTitle" class="form-label">Tiêu đề</label>
                        <input
                            type="text"
                            class="form-control"
                            id="assignmentTitle"
                            [(ngModel)]="newAssignment.title"
                            name="title"
                            required
                        />
                    </div>
                    <div class="mb-3">
                        <label for="assignmentContent" class="form-label">Nội dung</label>
                        <textarea
                            class="form-control"
                            id="assignmentContent"
                            rows="3"
                            [(ngModel)]="newAssignment.content"
                            name="content"
                            required
                        ></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="assignmentDeadline" class="form-label">Hạn nộp (dd/MM/yyyy)</label>
                        <input
                            type="text"
                            class="form-control"
                            id="assignmentDeadline"
                            placeholder="VD: 31/12/2024"
                            [(ngModel)]="newAssignment.deadline"
                            name="deadline"
                            pattern="\d{1,2}/\d{1,2}/\d{4}"
                            required
                        />
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" (click)="closeAssignmentModal()">Hủy</button>
                        <button type="submit" class="btn btn-success">Thêm bài tập</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Modal backdrop -->
<div
    class="modal-backdrop fade show"
    *ngIf="showAnnouncementModal || showDocumentModal || showAssignmentModal || showAnnouncementDetailModal"
    (click)="
        showAnnouncementModal = false;
        showDocumentModal = false;
        showAssignmentModal = false;
        showAnnouncementDetailModal = false
    "
></div>

<!-- Delete Confirmation Modal -->
<div
    class="modal fade"
    id="deleteAssignmentModal"
    tabindex="-1"
    aria-labelledby="deleteAssignmentModalLabel"
    aria-hidden="true"
>
    <div class="modal-dialog modal-dialog-centered">
        <!-- Thêm modal-dialog-centered -->
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteAssignmentModalLabel">Xác nhận xóa</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="text-center">
                    <i class="bi bi-exclamation-triangle text-warning display-4 mb-3"></i>
                    <p class="mb-3">Bạn có chắc chắn muốn xóa bài tập này?</p>
                    <p class="fw-bold text-danger">{{ assignmentToDelete?.title }}?</p>
                    <p class="text-muted small">Hành động này không thể hoàn tác.</p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-danger" (click)="deleteAssignment()">
                    <i class="bi bi-trash me-2"></i>Xóa
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div
    class="modal fade"
    id="deleteDocumentModal"
    tabindex="-1"
    aria-labelledby="deleteDocumentModalLabel"
    aria-hidden="true"
>
    <div class="modal-dialog modal-dialog-centered">
        <!-- Thêm modal-dialog-centered -->
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteDocumentModalLabel">Xác nhận xóa</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="text-center">
                    <i class="bi bi-exclamation-triangle text-warning display-4 mb-3"></i>
                    <p class="mb-3">Bạn có chắc chắn muốn xóa tài liệu này?</p>
                    <p class="fw-bold text-danger">{{ documentToDelete?.title }}?</p>
                    <p class="text-muted small">Hành động này không thể hoàn tác.</p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-danger" (click)="deleteAssignment()">
                    <i class="bi bi-trash me-2"></i>Xóa
                </button>
            </div>
        </div>
    </div>
</div>
